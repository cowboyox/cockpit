<!DOCTYPE html>
<html>
<head>
    <title>Cockpit terminal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../@@latest@@/cockpit.css" type="text/css" rel="stylesheet">
    <script src="../@@latest@@/jquery.js"></script>
    <script src="../@@latest@@/cockpit.js"></script>
</head>
<body>
    <div id="internal" class="container-fluid">
        <img src="hammer.gif" style="float: right;" onclick="$(this).hide();">
        <div id="nav"></div>
        <button class="btn btn-default" id="go-down">Go down</button>
        <br/>
        <br/>
        <div class="cockpit-internal-reauthorize">
            <button class="btn btn-default">Priveleged Action</button>
            <span></span>
        </div>
    </div>
<script>
(function(cockpit, $) {
    $(".cockpit-internal-reauthorize .btn").on("click", function() {
         $(".cockpit-internal-reauthorize span").text("checking...");
         var cmd = "pkcheck --action-id org.freedesktop.policykit.exec --process $$ -u 2>&1";
         cockpit.spawn(["sh", "-c", cmd]).
             stream(function(data) {
                 console.debug(data);
             }).
             done(function() {
                 $(".cockpit-internal-reauthorize span").text("result: authorized");
             }).
             fail(function() {
                 $(".cockpit-internal-reauthorize span").text("result: not-authorized");
             });
         });

    function update_nav() {
        $('#nav').empty();
        var path = [ "top" ].concat(cockpit.location.path);
        $(path).each(function (i, p) {
            if (i < path.length-1) {
                $('#nav').append(
                    $('<a>').
                        text(p).
                        click(function () {
                            cockpit.location.go(path.slice(1,i+1));
                        }),
                    " >> ");
            } else {
                $('#nav').append(
                    $('<span>').text(p));
            }
        });
    }

    $(cockpit).on('locationchanged', update_nav);
    update_nav();

    $('#go-down').click(function () {
        var len = cockpit.location.path.length;
        cockpit.location.go(cockpit.location.path.concat(len.toString()), { length: len.toString() });
    });

}(cockpit, jQuery));
</script>
</body>
</html>
